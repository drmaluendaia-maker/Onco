<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía de Práctica Clínica: Hematología y Oncología Pediátrica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1f2937;
            --card-bg: #ffffff;
            --header-bg: rgba(255, 255, 255, 0.8);
            --border-color: #e5e7eb;
            --primary-color: #3b82f6;
            --input-bg: #ffffff;
        }
        
        html.dark {
            --bg-color: #111827;
            --text-color: #d1d5db;
            --card-bg: #1f2937;
            --header-bg: rgba(31, 41, 55, 0.8);
            --border-color: #374151;
            --input-bg: #374151;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.2s;
        }
        
        .bg-card { background-color: var(--card-bg); }
        .border-custom { border-color: var(--border-color); }
        .bg-header { background-color: var(--header-bg); }
        .input-custom { background-color: var(--input-bg); color: var(--text-color); border-color: var(--border-color); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        html.dark ::-webkit-scrollbar-track { background: #2d3748; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }
        details > summary::after { content: ' ▸'; float: right; transform: rotate(0deg); transition: transform 0.2s; }
        details[open] > summary::after { transform: rotate(90deg); }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-btn.active { border-bottom-color: var(--primary-color); color: var(--primary-color); font-weight: 600; }
        
        .calculator-card { 
            background-color: #f3f4f6; 
            border-left: 5px solid var(--primary-color); 
            padding: 1.5rem; 
            border-radius: 0.5rem; 
            margin-top: 1rem;
        }
        html.dark .calculator-card { background-color: #2d3748; }
        
        .favorite-btn { cursor: pointer; opacity: 0.6; transition: all 0.2s; }
        .favorite-btn:hover { opacity: 1; transform: scale(1.1); }
        .favorite-btn.saved { color: #facc15; opacity: 1; }

        .highlight { background-color: #fef08a; border-radius: 3px; color: #1f2937; }

        #favorites-panel { transition: transform 0.3s ease-in-out; background-color: var(--card-bg); }
        #mobile-menu { background-color: var(--card-bg); }

    </style>
</head>

<body>

    <header class="bg-header backdrop-blur-lg shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <a href="#inicio" class="text-xl font-bold text-blue-600">Guía Hemo-Onco Notti</a>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#debut-leucemico" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Leucemia</a>
                    <a href="#neutropenia-febril" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">N. Febril</a>
                    <a href="#lisis-tumoral" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">SLT</a>
                    <a href="#anemia" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Anemia</a>
                    <a href="#purpura" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Púrpura</a>
                </div>
                <div class="flex items-center">
                    <button id="theme-toggle" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400 mr-4 p-1 rounded-full">
                        <svg id="theme-icon-light" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                        <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    </button>
                    <button id="favorites-toggle-btn" class="text-gray-600 hover:text-yellow-500 dark:text-gray-300 dark:hover:text-yellow-400 mr-4">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                    <button id="mobile-menu-button" class="md:hidden text-gray-700 dark:text-gray-300 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
             <div id="mobile-menu" class="hidden md:hidden mt-3 border-t border-custom">
                <a href="#debut-leucemico" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Debut Leucémico</a>
                <a href="#neutropenia-febril" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Neutropenia Febril</a>
                <a href="#lisis-tumoral" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Síndrome de Lisis Tumoral</a>
                 <a href="#anemia" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Anemia</a>
                <a href="#purpura" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Púrpura</a>
            </div>
        </nav>
    </header>
    
    <div id="favorites-panel" class="fixed top-0 right-0 h-full w-80 shadow-2xl p-6 z-50 transform translate-x-full">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Acceso Rápido</h2>
            <button id="close-favorites-btn" class="text-gray-500 hover:text-gray-800 dark:text-gray-300 text-3xl">&times;</button>
        </div>
        <div id="favorites-list" class="space-y-2 overflow-y-auto h-[calc(100%-4rem)]"></div>
    </div>

    <main id="main-content" class="container mx-auto p-4 md:p-8">

        <section id="inicio" class="text-center pt-16 pb-12">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Guía de Práctica Clínica: Hematología y Oncología</h1>
            <h2 class="text-2xl md:text-3xl font-semibold text-blue-600 mb-6">Hospital Pediátrico Notti</h2>
             <div class="relative max-w-xl mx-auto my-8">
                <input type="search" id="global-search-input" placeholder="Buscar en toda la guía..." class="w-full pl-10 pr-4 py-2 border rounded-full input-custom focus:ring-blue-500 focus:border-blue-500">
                <svg class="w-5 h-5 text-gray-400 absolute top-1/2 left-4 -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
                 <a href="#debut-leucemico" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Debut Leucémico</h3></a>
                <a href="#neutropenia-febril" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Neutropenia Febril</h3></a>
                <a href="#lisis-tumoral" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Síndrome de Lisis Tumoral</h3></a>
                <a href="#anemia" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Anemia</h3></a>
                <a href="#purpura" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Púrpura y PTI</h3></a>
                <a href="#enterocolitis" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Enterocolitis Neutropénica</h3></a>
                 <a href="#hemoderivados" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Hemoderivados</h3></a>
                <a href="#guia-pdf" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Guía Completa en PDF</h3></a>
            </div>
        </section>

        <div class="space-y-12">

            <section id="debut-leucemico" class="pt-20 -mt-20">
                <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg">
                    <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-blue-500 pb-3 mb-6 flex justify-between items-center">
                        <span>Debut Leucémico</span>
                        <span class="favorite-btn" data-id="debut-leucemico" data-title="Debut Leucémico">★</span>
                    </h2>
                    <div class="space-y-6">
                        <p>La leucemia es el cáncer más frecuente en la infancia (30% de las neoplasias). 80% LLA y 17% LMA.</p>
                        <details class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                            <summary class="font-semibold text-lg text-blue-800 dark:text-blue-400">Clínica y Laboratorio</summary>
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h4 class="font-bold">Síntomas Clínicos:</h4>
                                    <ul class="list-disc list-inside text-sm">
                                        <li>Afectación del estado general, síndrome anémico (palidez, cansancio), diátesis hemorrágica (petequias), fiebre, dolor óseo, hepatoesplenomegalia, adenopatías.</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-bold">Signos de Alerta en Laboratorio:</h4>
                                    <ul class="list-disc list-inside text-sm">
                                        <li>Anemia, Trombocitopenia (&lt;100.000), Leucocitosis/Leucopenia con blastos, afectación de ≥2 series, LDH y Ácido Úrico elevados.</li>
                                    </ul>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
            </section>

            <section id="neutropenia-febril" class="pt-20 -mt-20">
                <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg">
                    <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-blue-500 pb-3 mb-6 flex justify-between items-center">
                        <span>Neutropenia Febril</span>
                        <span class="favorite-btn" data-id="neutropenia-febril" data-title="Neutropenia Febril">★</span>
                    </h2>
                    <div class="space-y-6">
                        <div class="border-b border-custom">
                            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                                <button class="tab-btn active" data-tab="nf-tools">Herramientas</button>
                                <button class="tab-btn" data-tab="nf-tables">Dosificación</button>
                            </nav>
                        </div>
                        <div id="tab-content-nf-tools" class="tab-content active">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="calculator-card border-blue-500">
                                    <h3 class="font-semibold">Algoritmo de Tratamiento Inicial</h3>
                                    <div id="nf-step-1" class="mt-2">
                                        <p class="mb-2 text-sm">Paso 1: ¿Signos de sepsis/shock?</p>
                                        <div class="flex space-x-4"><button onclick="handleNfAlgorithm('sepsis_yes')" class="flex-1 bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-600">Sí</button><button onclick="handleNfAlgorithm('sepsis_no')" class="flex-1 bg-gray-300 dark:bg-gray-600 py-2 px-4 rounded hover:bg-gray-400">No</button></div>
                                    </div>
                                    <div id="nf-step-2" class="hidden mt-2"><p class="mb-2 text-sm">Paso 2: ¿Criterios de Alto Riesgo (NFAR)?</p><div class="flex space-x-4"><button onclick="handleNfAlgorithm('nfar_yes')" class="flex-1 bg-orange-500 text-white font-bold py-2 px-4 rounded hover:bg-orange-600">Sí (NFAR)</button><button onclick="handleNfAlgorithm('nfar_no')" class="flex-1 bg-green-500 text-white font-bold py-2 px-4 rounded hover:bg-green-600">No (NFBR)</button></div></div>
                                    <div id="nf-result" class="mt-4 p-3 bg-blue-100 dark:bg-blue-900/50 rounded-md text-center hidden"></div><button id="nf-reset-btn" onclick="resetNfAlgorithm()" class="mt-4 w-full text-sm text-blue-600 hover:underline hidden">Reiniciar</button>
                                </div>
                                <div class="calculator-card border-cyan-500">
                                    <h3 class="font-semibold">Manejo Infección de CVC</h3>
                                    <div id="cvc-step-1" class="mt-2"><p class="mb-2 text-sm">Paso 1: ¿Infección complicada?</p><div class="flex space-x-4"><button onclick="handleCvcAlgorithm('comp_yes')" class="flex-1 bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-600">Sí</button><button onclick="handleCvcAlgorithm('comp_no')" class="flex-1 bg-gray-300 dark:bg-gray-600 py-2 px-4 rounded hover:bg-gray-400">No</button></div></div>
                                    <div id="cvc-step-2" class="hidden mt-2"><p class="mb-2 text-sm">Paso 2: Microorganismo aislado</p><select id="cvc-microorganism" class="w-full p-2 border rounded input-custom"><option value="s_aureus">S. aureus / Pseudomonas / Candida</option><option value="other">Otro</option></select><button onclick="handleCvcAlgorithm('microbe_selected')" class="mt-3 w-full bg-cyan-600 text-white font-bold py-2 px-4 rounded hover:bg-cyan-700">Ver</button></div>
                                    <div id="cvc-result" class="mt-4 p-3 bg-cyan-100 dark:bg-cyan-900/50 rounded-md text-center hidden"></div><button id="cvc-reset-btn" onclick="resetCvcAlgorithm()" class="mt-4 w-full text-sm text-cyan-600 hover:underline hidden">Reiniciar</button>
                                </div>
                            </div>
                        </div>
                        <div id="tab-content-nf-tables" class="tab-content">
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div><h3 class="text-xl font-semibold mb-2 text-blue-800 dark:text-blue-400">Antimicrobianos</h3><div class="overflow-x-auto max-h-72"><table class="w-full text-left border-collapse">...</table></div></div>
                                <div><h3 class="text-xl font-semibold mb-2 text-blue-800 dark:text-blue-400">Antifúngicos</h3><div class="overflow-x-auto max-h-72"><table class="w-full text-left border-collapse">...</table></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="lisis-tumoral" class="pt-20 -mt-20">
                <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg">
                     <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-blue-500 pb-3 mb-6 flex justify-between items-center">
                        <span>Síndrome de Lisis Tumoral (SLT)</span>
                        <span class="favorite-btn" data-id="lisis-tumoral" data-title="Lisis Tumoral">★</span>
                    </h2>
                     <div class="space-y-6">
                        <p>Emergencia oncológica por destrucción masiva de células malignas con liberación de contenido intracelular.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="calculator-card border-red-500">
                                <h3 class="font-semibold">Calculadora de Riesgo de SLT</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                    <div><label class="text-sm">Tipo de Tumor</label><select id="slt-tumor-type" class="mt-1 block w-full p-2 border rounded input-custom"><option value="bajo">LMC</option><option value="moderado">LMA (25-100k)</option><option value="alto">Burkitt / LLA (≥100k)</option></select></div>
                                    <div><label class="text-sm">LDH</label><select id="slt-ldh" class="mt-1 block w-full p-2 border rounded input-custom"><option value="normal">&lt; 2x LSN</option><option value="alto">≥ 2x LSN</option></select></div>
                                </div>
                                <button onclick="calculateTlsRisk()" class="mt-4 w-full bg-red-600 text-white font-bold py-2 px-4 rounded hover:bg-red-700">Calcular Riesgo</button><div id="slt-risk-result" class="mt-3 p-3 bg-red-100 dark:bg-red-900/50 rounded-md text-center hidden"></div>
                            </div>
                             <div class="calculator-card border-green-500">
                                <h3 class="font-semibold">Calculadora de Hidratación</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                    <div><label class="text-sm">Peso (kg)</label><input type="number" id="bsa-weight" class="mt-1 block w-full p-2 border rounded input-custom"></div>
                                    <div><label class="text-sm">Altura (cm)</label><input type="number" id="bsa-height" class="mt-1 block w-full p-2 border rounded input-custom"></div>
                                </div>
                                <button onclick="calculateBsaAndHydration()" class="mt-4 w-full bg-green-600 text-white font-bold py-2 px-4 rounded hover:bg-green-700">Calcular</button><div id="bsa-result" class="mt-3 p-3 bg-green-100 dark:bg-green-900/50 rounded-md text-center hidden"></div>
                            </div>
                            <div class="calculator-card border-yellow-500">
                                <h3 class="font-semibold">Calculadora Dosis de Alopurinol</h3>
                                <div class="mt-2"><label class="text-sm">Peso (kg)</label><input type="number" id="alopurinol-weight" class="mt-1 block w-full p-2 border rounded input-custom"></div>
                                <button onclick="calculateAllopurinol()" class="mt-4 w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded hover:bg-yellow-600">Calcular Dosis</button><div id="alopurinol-result" class="mt-3 p-3 bg-yellow-100 dark:bg-yellow-900/50 rounded-md text-center hidden"></div>
                            </div>
                             <div class="calculator-card border-red-500">
                                <h3 class="font-semibold">Calculadora de Hiperkalemia</h3>
                                <div class="mt-2"><label class="text-sm">Peso (kg)</label><input type="number" id="kalemia-weight" class="mt-1 block w-full p-2 border rounded input-custom"></div>
                                <button onclick="calculateHyperkalemia()" class="mt-4 w-full bg-red-600 text-white font-bold py-2 px-4 rounded hover:bg-red-700">Calcular Dosis</button><div id="kalemia-result" class="mt-3 p-3 bg-red-100 dark:bg-red-900/50 rounded-md hidden"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="anemia" class="pt-20 -mt-20">
                 <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg">
                    <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-blue-500 pb-3 mb-6 flex justify-between items-center">
                        <span>Anemia</span>
                        <span class="favorite-btn" data-id="anemia" data-title="Anemia">★</span>
                    </h2>
                     <div class="space-y-6">
                        <div class="border-b border-custom">
                            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                                <button class="tab-btn active" data-tab="anemia-tools">Herramientas</button>
                                <button class="tab-btn" data-tab="anemia-info">Clasificación</button>
                            </nav>
                        </div>
                         <div id="tab-content-anemia-tools" class="tab-content active">
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="calculator-card border-yellow-500">
                                    <h3 class="font-semibold">Dosis Hierro Parenteral</h3>
                                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-2">
                                        <div><label class="text-sm">Peso (kg)</label><input type="number" id="iron-weight" class="mt-1 w-full p-2 border rounded input-custom"></div>
                                        <div><label class="text-sm">Hb Teórica</label><input type="number" id="iron-hb-target" class="mt-1 w-full p-2 border rounded input-custom" value="12"></div>
                                        <div><label class="text-sm">Hb Real</label><input type="number" id="iron-hb-actual" class="mt-1 w-full p-2 border rounded input-custom"></div>
                                    </div>
                                    <button onclick="calculateIronDose()" class="mt-4 w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded hover:bg-yellow-600">Calcular</button><div id="iron-result" class="mt-3 p-3 bg-yellow-100 dark:bg-yellow-900/50 rounded-md text-center hidden"></div>
                                </div>
                                <div class="calculator-card border-teal-500">
                                    <h3 class="font-semibold">Profilaxis de Hierro en Lactantes</h3>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2">
                                        <div><label class="text-sm">Condición</label><select id="prophylaxis-condition" class="mt-1 w-full p-2 border rounded input-custom"><option value="term">RN Término</option><option value="preterm-1500-2000">RN Pretérmino (1.5-2kg)</option><option value="preterm-750-1500">RN Pretérmino (0.75-1.5kg)</option><option value="preterm-lt-750">RN Pretérmino (&lt;0.75kg)</option></select></div>
                                        <div><label class="text-sm">Peso (kg)</label><input type="number" id="prophylaxis-weight" class="mt-1 w-full p-2 border rounded input-custom"></div>
                                    </div>
                                    <button onclick="calculateIronProphylaxis()" class="mt-4 w-full bg-teal-500 text-white font-bold py-2 px-4 rounded hover:bg-teal-600">Calcular</button><div id="prophylaxis-result" class="mt-3 p-3 bg-teal-100 dark:bg-teal-900/50 rounded-md text-center hidden"></div>
                                </div>
                             </div>
                              <div class="calculator-card border-cyan-500">
                                <h3 class="font-semibold">Ayuda Dx Anemia Microcítica</h3>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-2 text-sm">
                                    <div><label>Ferremia</label><select id="diff-ferremia" class="mt-1 w-full p-2 border rounded input-custom"><option value="D">Baja</option><option value="N">Normal</option><option value="A">Alta</option></select></div>
                                    <div><label>Sat. Transferrina</label><select id="diff-saturation" class="mt-1 w-full p-2 border rounded input-custom"><option value="D">Baja</option><option value="N">Normal</option><option value="A">Alta</option></select></div>
                                    <div><label>Ferritina</label><select id="diff-ferritin" class="mt-1 w-full p-2 border rounded input-custom"><option value="D">Baja</option><option value="N">Normal</option><option value="A">Alta</option></select></div>
                                    <div><label>Hb A2</label><select id="diff-hba2" class="mt-1 w-full p-2 border rounded input-custom"><option value="N">Normal/Baja</option><option value="A">Alta</option></select></div>
                                </div>
                                <button onclick="diagnoseMicrocyticAnemia()" class="mt-4 w-full bg-cyan-600 text-white font-bold py-2 px-4 rounded hover:bg-cyan-700">Analizar</button><div id="differential-result" class="mt-3 p-3 bg-cyan-100 dark:bg-cyan-900/50 rounded-md text-center hidden"></div>
                            </div>
                         </div>
                         <div id="tab-content-anemia-info" class="tab-content">
                             <div class="space-y-4 text-sm">
                                <p><strong>Microcítica:</strong> Causa más frecuente. Sospechar ferropenia. Otras: Talasemias, anemia de la inflamación.</p>
                                <p><strong>Normocítica:</strong> Evaluar reticulocitos. ↑ sugiere hemólisis/hemorragia. N/↓ sugiere defecto en producción (enf. sistémica, aplasia).</p>
                                <p><strong>Macrocítica:</strong> Poco frecuente. Megaloblástica (déficit fólico/B12) o No Megaloblástica (hepatopatía, hipotiroidismo).</p>
                            </div>
                         </div>
                    </div>
                </div>
            </section>
            
            <section id="purpura" class="pt-20 -mt-20">
                <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg">
                    <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-blue-500 pb-3 mb-6 flex justify-between items-center">
                        <span>Púrpura y PTI</span>
                        <span class="favorite-btn" data-id="purpura" data-title="Púrpura y PTI">★</span>
                    </h2>
                    <div class="space-y-6">
                        <p>La Púrpura Trombocitopénica Inmune (PTI) es la causa más común de hemorragia adquirida en la infancia. Es un diagnóstico de exclusión con trombocitopenia aislada (&lt;100.000/μl).</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                             <div class="calculator-card border-indigo-500">
                                <h3 class="font-semibold">Tratamiento PTI 1ª Línea</h3>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2">
                                    <div><label class="text-sm">Peso (kg)</label><input type="number" id="pti-weight" class="mt-1 block w-full p-2 border rounded input-custom"></div>
                                    <div><label class="text-sm">Fármaco</label><select id="pti-treatment" class="mt-1 block w-full p-2 border rounded input-custom"><option value="prednisona">Prednisona</option><option value="metilprednisolona">Metilprednisolona</option><option value="igiv">Ig IV</option></select></div>
                                </div>
                                <button onclick="calculatePtiDose()" class="mt-4 w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded hover:bg-indigo-700">Calcular Dosis</button><div id="pti-result" class="mt-3 p-3 bg-indigo-100 dark:bg-indigo-900/50 rounded-md text-center hidden"></div>
                            </div>
                             <div class="calculator-card border-cyan-500">
                                <h3 class="font-semibold">Infusión de Gammaglobulina</h3>
                                <div class="mt-2"><label class="text-sm">Peso (kg)</label><input type="number" id="igiv-weight" class="mt-1 block w-full p-2 border rounded input-custom"></div>
                                <button onclick="calculateIgivInfusion()" class="mt-4 w-full bg-cyan-600 text-white font-bold py-2 px-4 rounded hover:bg-cyan-700">Generar Plan</button><div id="igiv-result" class="mt-3 p-3 bg-cyan-100 dark:bg-cyan-900/50 rounded-md hidden"></div>
                            </div>
                        </div>
                        <details class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                            <summary class="font-semibold text-lg text-blue-800 dark:text-blue-400">Púrpura de Schönlein-Henoch</summary>
                            <div class="mt-4 text-sm">
                                <p>Vasculitis con tétrada clásica (no siempre completa): Púrpura palpable (MMII, glúteos), Artralgias/Artritis (rodillas, tobillos), Dolor abdominal y Afectación renal. <strong>El recuento de plaquetas es normal.</strong></p>
                            </div>
                        </details>
                    </div>
                </div>
            </section>
            
            <section id="enterocolitis" class="pt-20 -mt-20">
                <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg">
                    <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-blue-500 pb-3 mb-6 flex justify-between items-center">
                        <span>Enterocolitis Neutropénica</span>
                        <span class="favorite-btn" data-id="enterocolitis" data-title="Enterocolitis">★</span>
                    </h2>
                     <div class="space-y-4">
                        <p>Inflamación necrotizante del ciego (tiflitis), una complicación grave. Alta sospecha en pacientes con LMA, LLA, TPH y neutropenia profunda.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                            <div><h4 class="font-bold">Clínica:</h4><ul class="list-disc list-inside"><li>Fiebre, Dolor Abdominal (FID), Distensión, Diarrea.</li></ul></div>
                            <div><h4 class="font-bold">Manejo:</h4><ul class="list-disc list-inside"><li>Reposo intestinal, ATB amplio espectro (Ej: Cefepime+Metronidazol o Pipe-Tazo).</li></ul></div>
                        </div>
                    </div>
                </div>
            </section>
            
             <section id="hemoderivados" class="pt-20 -mt-20">
                <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg">
                    <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-blue-500 pb-3 mb-6 flex justify-between items-center">
                        <span>Guía de Hemoderivados</span>
                        <span class="favorite-btn" data-id="hemoderivados" data-title="Hemoderivados">★</span>
                    </h2>
                    <div class="space-y-6">
                         <div class="calculator-card border-purple-500">
                            <h3 class="font-semibold">Calculadora de Dosis de Transfusión</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                <div><label class="text-sm">Peso (kg)</label><input type="number" id="trans-weight" class="mt-1 block w-full p-2 border rounded input-custom"></div>
                                <div><label class="text-sm">Componente</label><div class="mt-2 space-x-4"><label><input type="radio" name="component" value="rbc" checked> GR</label><label><input type="radio" name="component" value="platelets"> Plaquetas</label></div></div>
                            </div>
                            <button onclick="calculateTransfusion()" class="mt-4 w-full bg-purple-600 text-white font-bold py-2 px-4 rounded hover:bg-purple-700">Calcular Dosis</button><div id="transfusion-result" class="mt-3 p-3 bg-purple-100 dark:bg-purple-900/50 rounded-md text-center hidden"></div>
                        </div>
                    </div>
                </div>
            </section>

             <section id="guia-pdf" class="pt-20 -mt-20">
                <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg text-center">
                    <h2 class="text-2xl md:text-3xl font-bold mb-4">Guía Completa en PDF</h2>
                    <p class="mb-4">Para una referencia detallada, consulte el documento original.</p>
                    <a href="https://drive.google.com/file/d/1yL1qRgwMIV56bgpHFk1Mnbpa0NdwaeXN/view?usp=drive_link" target="_blank" rel="noopener noreferrer" class="inline-block bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors">Ver Guía en Línea</a>
                </div>
            </section>
        </div>
    </main>
<script>
    // --- SETUP ---
    document.addEventListener('DOMContentLoaded', () => {
        // Defer non-critical setups
        requestAnimationFrame(() => {
            setupMobileMenu();
            setupFavorites();
            setupTabs();
            setupTheme();
            setupGlobalSearch();
            // Attach calculator functions that were missing from the previous version
            attachCalculatorFunctions();
        });
    });

    function attachCalculatorFunctions() {
        // This function re-populates the window object with calculator functions
        // that might have been lost in previous edits.
        window.calculateTlsRisk = function() {
            const tumorType = document.getElementById('slt-tumor-type').value;
            const ldh = document.getElementById('slt-ldh').value;
            const resultDiv = document.getElementById('slt-risk-result');
            let riskLevel = tumorType;
            if (ldh === 'alto' && riskLevel === 'moderado') riskLevel = 'alto';
            let riskText = '';
            if (riskLevel === 'alto') riskText = '<span class="font-bold text-red-700">RIESGO ALTO.</span> Considerar Rasburicase.';
            else if (riskLevel === 'moderado') riskText = '<span class="font-bold text-orange-700">RIESGO MODERADO.</span> Iniciar Alopurinol.';
            else riskText = '<span class="font-bold text-green-700">RIESGO BAJO.</span> Monitoreo.';
            resultDiv.innerHTML = riskText;
            resultDiv.classList.remove('hidden');
        };

        window.calculateBsaAndHydration = function() {
            const weight = parseFloat(document.getElementById('bsa-weight').value);
            const height = parseFloat(document.getElementById('bsa-height').value);
            const resultDiv = document.getElementById('bsa-result');
            if (!weight || !height || weight <= 0 || height <= 0) {
                resultDiv.innerHTML = `<p class="text-red-600">Datos inválidos.</p>`;
                resultDiv.classList.remove('hidden'); return;
            }
            if (weight < 10) {
                resultDiv.innerHTML = `<p class="font-bold">Hidratación: ${(200 * weight).toFixed(0)} ml/día</p>`;
            } else {
                const bsa = Math.sqrt((weight * height) / 3600);
                resultDiv.innerHTML = `<p>SC: <span class="font-bold">${bsa.toFixed(2)} m²</span> | Hidratación: <span class="font-bold">${(3000 * bsa).toFixed(0)} ml/día</span></p>`;
            }
            resultDiv.classList.remove('hidden');
        };

        window.calculateAllopurinol = function() {
            const weight = parseFloat(document.getElementById('alopurinol-weight').value);
            const resultDiv = document.getElementById('alopurinol-result');
            if (!validateWeight(weight, resultDiv)) return;
            resultDiv.innerHTML = `Dosis diaria: <strong class="text-lg">${(10 * weight).toFixed(0)} mg</strong> (en 3 tomas).`;
            resultDiv.classList.remove('hidden');
        };
        
        window.calculateHyperkalemia = function() {
            const weight = parseFloat(document.getElementById('kalemia-weight').value);
            const resultDiv = document.getElementById('kalemia-result');
            if (!validateWeight(weight, resultDiv)) return;
            resultDiv.innerHTML = `<ul class="text-sm space-y-1">
                <li><strong class="text-blue-700 dark:text-blue-400">Gluconato Ca 10%:</strong> ${(1.5 * weight).toFixed(1)} ml</li>
                <li><strong class="text-blue-700 dark:text-blue-400">Sol. Polarizante:</strong> ${(0.75 * weight).toFixed(1)}g Glucosa + ${(0.075 * weight).toFixed(2)}U Insulina</li>
                <li><strong class="text-blue-700 dark:text-blue-400">NaHCO3:</strong> ${(1.5 * weight).toFixed(1)} mEq</li>
                </ul>`;
            resultDiv.classList.remove('hidden');
        };
        
        window.calculateIronDose = function() {
            const weight = parseFloat(document.getElementById('iron-weight').value);
            const hbTarget = parseFloat(document.getElementById('iron-hb-target').value);
            const hbActual = parseFloat(document.getElementById('iron-hb-actual').value);
            const resultDiv = document.getElementById('iron-result');
            if (!weight || !hbTarget || !hbActual || weight <= 0) {
                resultDiv.innerHTML = `<p class="text-red-600">Datos inválidos.</p>`;
                resultDiv.classList.remove('hidden'); return;
            }
            const ironDeficit = (hbTarget - hbActual) * (weight * 80) * 3.4 * 1.5 / 100;
            resultDiv.innerHTML = `Dosis total a reponer: <strong class="text-lg">${ironDeficit.toFixed(0)} mg</strong>`;
            resultDiv.classList.remove('hidden');
        };

        window.calculateIronProphylaxis = function() {
            const weight = parseFloat(document.getElementById('prophylaxis-weight').value);
            const resultDiv = document.getElementById('prophylaxis-result');
            if (!validateWeight(weight, resultDiv)) return;
            const condition = document.getElementById('prophylaxis-condition').value;
            const multipliers = { term: 1, 'preterm-1500-2000': 2, 'preterm-750-1500': 3.5, 'preterm-lt-750': 5.5 };
            resultDiv.innerHTML = `Dosis: <strong class="text-lg">${(multipliers[condition] * weight).toFixed(1)} mg/día</strong> de Hierro elemental.`;
            resultDiv.classList.remove('hidden');
        };

        window.diagnoseMicrocyticAnemia = function() {
            const ferremia = document.getElementById('diff-ferremia').value;
            const saturation = document.getElementById('diff-saturation').value;
            const ferritin = document.getElementById('diff-ferritin').value;
            const hba2 = document.getElementById('diff-hba2').value;
            const resultDiv = document.getElementById('differential-result');
            let diagnosis = '<span class="font-bold">Patrón no concluyente.</span>';
            if (ferremia === 'D' && saturation === 'D' && ferritin === 'D') diagnosis = '<span class="font-bold text-green-700">Orientación: Anemia Ferropénica.</span>';
            else if (ferremia === 'N' && saturation === 'N' && ferritin === 'N' && hba2 === 'A') diagnosis = '<span class="font-bold text-blue-700">Orientación: Beta Talasemia.</span>';
            else if (ferremia === 'D' && ferritin === 'A') diagnosis = '<span class="font-bold text-orange-700">Orientación: Anemia de la Inflamación.</span>';
            resultDiv.innerHTML = diagnosis;
            resultDiv.classList.remove('hidden');
        };
        
        window.calculatePtiDose = function() {
            const weight = parseFloat(document.getElementById('pti-weight').value);
            const resultDiv = document.getElementById('pti-result');
            if (!validateWeight(weight, resultDiv)) return;
            const treatment = document.getElementById('pti-treatment').value;
            let doseText = '';
            if (treatment === 'prednisona') doseText = `Prednisona: <strong>${Math.min(4 * weight, 180).toFixed(1)} mg/día</strong> (4 días).`;
            else if (treatment === 'metilprednisolona') doseText = `Metilprednisolona: <strong>${Math.min(30 * weight, 1000).toFixed(0)} mg/dosis</strong> (3 dosis).`;
            else if (treatment === 'igiv') doseText = `Inmunoglobulina IV: <strong>${(1 * weight).toFixed(1)} g/día</strong> (1-2 días).`;
            resultDiv.innerHTML = doseText;
            resultDiv.classList.remove('hidden');
        };

        window.calculateTransfusion = function() {
            const weight = parseFloat(document.getElementById('trans-weight').value);
            const resultDiv = document.getElementById('transfusion-result');
            if (!validateWeight(weight, resultDiv)) return;
            const component = document.querySelector('input[name="component"]:checked').value;
            let resultText = '';
            if (component === 'rbc') resultText = `Dosis GR: <strong class="text-lg">${(10 * weight).toFixed(0)} ml</strong> (10 ml/kg).`;
            else resultText = `Dosis Plaquetas: <strong class="text-lg">${Math.round(weight / 10)} U</strong> (1U c/10 kg).`;
            resultDiv.innerHTML = resultText;
            resultDiv.classList.remove('hidden');
        };
    }

    // --- CORE UI FUNCTIONS ---
    function setupTheme() {
        const toggle = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('theme-icon-light');
        const darkIcon = document.getElementById('theme-icon-dark');
        const applyTheme = (theme) => {
            document.documentElement.classList.toggle('dark', theme === 'dark');
            lightIcon.classList.toggle('hidden', theme === 'dark');
            darkIcon.classList.toggle('hidden', theme !== 'dark');
        };
        let currentTheme = localStorage.getItem('theme') || 'light';
        applyTheme(currentTheme);
        toggle.addEventListener('click', () => {
            currentTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
            localStorage.setItem('theme', currentTheme);
            applyTheme(currentTheme);
        });
    }

    function setupMobileMenu() {
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });
    }

    function setupTabs() {
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab;
                const container = button.closest('.bg-card');
                container.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                container.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === `tab-content-${tabId}`);
                });
            });
        });
    }
    
    // --- ALGORITHMS ---
    function handleNfAlgorithm(decision) {
        const container = document.getElementById('neutropenia-febril');
        const step1 = container.querySelector('#nf-step-1');
        const step2 = container.querySelector('#nf-step-2');
        const resultDiv = container.querySelector('#nf-result');
        const resetBtn = container.querySelector('#nf-reset-btn');
        let html = '';
        step1.classList.add('hidden');
        if (decision === 'sepsis_yes') html = `<p class="font-bold text-red-700">Tratamiento:</p><p>Carbapenem + Vancomicina.</p>`;
        else if (decision === 'sepsis_no') { step2.classList.remove('hidden'); return; }
        else if (decision === 'nfar_yes') { html = `<p class="font-bold text-orange-700">Tratamiento (NFAR):</p><p>Cefepime o Pipe-Tazo.</p>`; step2.classList.add('hidden');}
        else if (decision === 'nfar_no') { html = `<p class="font-bold text-green-700">Tratamiento (NFBR):</p><p>Ceftriaxona o Cefotaxima.</p>`; step2.classList.add('hidden');}
        resultDiv.innerHTML = html;
        resultDiv.classList.remove('hidden');
        resetBtn.classList.remove('hidden');
    }
    function resetNfAlgorithm() {
        const c = document.getElementById('neutropenia-febril');
        c.querySelector('#nf-step-1').classList.remove('hidden'); c.querySelector('#nf-step-2').classList.add('hidden');
        c.querySelector('#nf-result').classList.add('hidden'); c.querySelector('#nf-reset-btn').classList.add('hidden');
    }
     function handleCvcAlgorithm(decision) {
        const c = document.getElementById('neutropenia-febril');
        const s1 = c.querySelector('#cvc-step-1'); const s2 = c.querySelector('#cvc-step-2');
        const res = c.querySelector('#cvc-result'); const btn = c.querySelector('#cvc-reset-btn');
        let html = '';
        s1.classList.add('hidden');
        if (decision === 'comp_yes') html = `<p class="font-bold text-red-700">Acción:</p><p>Remover CVC + Terapia Sistémica.</p>`;
        else if (decision === 'comp_no') { s2.classList.remove('hidden'); return; }
        else if (decision === 'microbe_selected') {
            const microbe = c.querySelector('#cvc-microorganism').value;
            html = microbe === 's_aureus' ? `<p class="font-bold text-red-700">Acción:</p><p>Remover CVC + Terapia Sistémica.</p>` : `<p class="font-bold text-green-700">Acción:</p><p>Terapia de Rescate (Sistémica + Sello).</p>`;
            s2.classList.add('hidden');
        }
        res.innerHTML = html; res.classList.remove('hidden'); btn.classList.remove('hidden');
    }
    function resetCvcAlgorithm() {
        const c = document.getElementById('neutropenia-febril');
        c.querySelector('#cvc-step-1').classList.remove('hidden'); c.querySelector('#cvc-step-2').classList.add('hidden');
        c.querySelector('#cvc-result').classList.add('hidden'); c.querySelector('#cvc-reset-btn').classList.add('hidden');
    }
    
    // --- FAVORITES & SEARCH ---
    function setupFavorites() {
        const toggleBtn = document.getElementById('favorites-toggle-btn');
        const closeBtn = document.getElementById('close-favorites-btn');
        const panel = document.getElementById('favorites-panel');
        toggleBtn.addEventListener('click', () => panel.classList.remove('translate-x-full'));
        closeBtn.addEventListener('click', () => panel.classList.add('translate-x-full'));
        loadFavorites();
        document.querySelectorAll('.favorite-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite(btn.dataset.id, btn.dataset.title);
            });
        });
    }
    function getFavorites() { return JSON.parse(localStorage.getItem('hemoncoFavoritesV4')) || []; }
    function saveFavorites(favorites) { localStorage.setItem('hemoncoFavoritesV4', JSON.stringify(favorites)); loadFavorites(); }
    function toggleFavorite(id, title) {
        let favorites = getFavorites();
        const index = favorites.findIndex(fav => fav.id === id);
        if (index > -1) favorites.splice(index, 1);
        else favorites.push({ id, title });
        saveFavorites(favorites);
    }
    function loadFavorites() {
        const favorites = getFavorites();
        document.querySelectorAll('.favorite-btn').forEach(btn => btn.classList.toggle('saved', favorites.some(f => f.id === btn.dataset.id)));
        const listDiv = document.getElementById('favorites-list');
        if (favorites.length === 0) {
            listDiv.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400">Guarde secciones con ★ para verlas aquí.</p>`; return;
        }
        listDiv.innerHTML = favorites.map(fav => `<a href="#${fav.id}" class="block p-2 bg-gray-100 dark:bg-gray-700 rounded hover:bg-blue-100 dark:hover:bg-blue-900 transition-colors text-sm">${fav.title}</a>`).join('');
        listDiv.querySelectorAll('a').forEach(a => a.addEventListener('click', () => document.getElementById('favorites-panel').classList.add('translate-x-full')));
    }
    
    function setupGlobalSearch() {
        const searchInput = document.getElementById('global-search-input');
        const performSearch = (query) => {
            removeHighlights();
            if (query.length < 3) return;
            const regex = new RegExp(query, 'gi');
            findAndHighlight(document.getElementById('main-content'), regex);
        };
        const findAndHighlight = (node, regex) => {
            if (node.nodeType === 3) {
                if(node.nodeValue.match(regex)){
                    const span = document.createElement('span');
                    span.innerHTML = node.nodeValue.replace(regex, match => `<span class="highlight">${match}</span>`);
                    node.parentNode.replaceChild(span, node);
                }
            } else if (node.nodeType === 1 && node.childNodes && !/script|style|svg/i.test(node.tagName)) {
                node.childNodes.forEach(child => findAndHighlight(child, regex));
            }
        };
        searchInput.addEventListener('input', (e) => performSearch(e.target.value));
    }
    function removeHighlights() {
        document.querySelectorAll('span.highlight').forEach(el => {
            const parent = el.parentNode;
            if(parent) {
                parent.replaceChild(document.createTextNode(el.textContent), el);
                parent.normalize();
            }
        });
    }

     function calculateIgivInfusion() {
        const weight = parseFloat(document.getElementById('igiv-weight').value);
        const resultDiv = document.getElementById('igiv-result');
        if (!validateWeight(weight, resultDiv)) return;
        
        const rates = [0.3, 0.6, 1.2, 2.4, 4.8, 6, 7.2];
        const intervals = [30, 30, 30, 30, 'hasta finalizar', 'hasta finalizar', 'hasta finalizar'];

        let tableHtml = `<h4 class="font-bold mb-2">Plan de Infusión Sugerido</h4>
                         <div class="overflow-x-auto"><table class="w-full text-sm text-left">
                           <thead class="bg-gray-200 dark:bg-gray-600"><tr>
                             <th class="p-2">Intervalo (min)</th> <th class="p-2">Velocidad (mL/kg/h)</th> <th class="p-2">Velocidad (mL/hora)</th>
                           </tr></thead><tbody>`;

        rates.forEach((rate, i) => {
            const calculatedRate = Math.min(rate * weight, 150).toFixed(1);
            tableHtml += `<tr class="border-b border-custom"><td class="p-2">${intervals[i]}</td><td class="p-2">${rate}</td><td class="p-2 font-bold">${calculatedRate}</td></tr>`;
        });
        
        tableHtml += `</tbody></table></div><p class="text-xs mt-2 italic">Basado en la plantilla Garrahan. Monitorear al paciente.</p>`;
        resultDiv.innerHTML = tableHtml;
        resultDiv.classList.remove('hidden');
    }
</script>

</body>
</html>
