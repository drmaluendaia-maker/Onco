<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía de Práctica Clínica: Hematología y Oncología Pediátrica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1f2937;
            --card-bg: #ffffff;
            --header-bg: rgba(255, 255, 255, 0.8);
            --border-color: #e5e7eb;
            --primary-color: #3b82f6;
            --input-bg: #ffffff;
        }
        
        html.dark {
            --bg-color: #111827;
            --text-color: #d1d5db;
            --card-bg: #1f2937;
            --header-bg: rgba(31, 41, 55, 0.8);
            --border-color: #374151;
            --input-bg: #374151;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        
        .bg-card { background-color: var(--card-bg); }
        .border-custom { border-color: var(--border-color); }
        .bg-header { background-color: var(--header-bg); }
        .input-custom { background-color: var(--input-bg); color: var(--text-color); border-color: var(--border-color); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }
        details > summary::after { content: ' ▸'; float: right; transform: rotate(0deg); transition: transform 0.2s; }
        details[open] > summary::after { transform: rotate(90deg); }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-btn.active { border-bottom-color: var(--primary-color); color: var(--primary-color); font-weight: 600; }
        
        .calculator-card { 
            background-color: #f3f4f6; 
            border-left: 5px solid var(--primary-color); 
            padding: 1.5rem; 
            border-radius: 0.5rem; 
            margin-top: 1rem;
        }
        html.dark .calculator-card { background-color: #374151; }
        
        .favorite-btn { cursor: pointer; opacity: 0.6; transition: all 0.2s; }
        .favorite-btn:hover { opacity: 1; transform: scale(1.1); }
        .favorite-btn.saved { color: #facc15; opacity: 1; }

        .highlight { background-color: #fef08a; border-radius: 3px; color: #1f2937; }

        #favorites-panel, #mobile-menu { 
            background-color: var(--card-bg);
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body>

    <header class="bg-header backdrop-blur-lg shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <a href="#inicio" class="text-xl font-bold text-blue-600">Guía Hemo-Onco Notti</a>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#debut-leucemico" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Leucemia</a>
                    <a href="#neutropenia-febril" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">N. Febril</a>
                    <a href="#lisis-tumoral" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">SLT</a>
                    <a href="#anemia" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Anemia</a>
                    <a href="#purpura" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Púrpura</a>
                </div>
                <div class="flex items-center">
                    <button id="theme-toggle" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400 mr-4 p-1 rounded-full">
                        <svg id="theme-icon-light" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                        <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    </button>
                    <button id="favorites-toggle-btn" class="text-gray-600 hover:text-yellow-500 dark:text-gray-300 dark:hover:text-yellow-400 mr-4">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    </button>
                    <button id="mobile-menu-button" class="md:hidden text-gray-700 dark:text-gray-300 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
             <div id="mobile-menu" class="hidden md:hidden mt-3 border-t border-custom">
                <a href="#debut-leucemico" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Debut Leucémico</a>
                <a href="#neutropenia-febril" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Neutropenia Febril</a>
                <a href="#lisis-tumoral" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Síndrome de Lisis Tumoral</a>
                <a href="#anemia" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Anemia</a>
                <a href="#purpura" class="block py-2 text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">Púrpura</a>
            </div>
        </nav>
    </header>
    
    <div id="favorites-panel" class="fixed top-0 right-0 h-full w-80 shadow-2xl p-6 z-50 transform translate-x-full">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Acceso Rápido</h2>
            <button id="close-favorites-btn" class="text-gray-500 hover:text-gray-800 dark:text-gray-300 text-3xl">&times;</button>
        </div>
        <div id="favorites-list" class="space-y-2 overflow-y-auto h-[calc(100%-4rem)]"></div>
    </div>

    <main id="main-content" class="container mx-auto p-4 md:p-8">

        <section id="inicio" class="text-center pt-16 pb-12">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Guía de Práctica Clínica: Hematología y Oncología</h1>
            <h2 class="text-2xl md:text-3xl font-semibold text-blue-600 mb-6">Hospital Pediátrico Notti</h2>
             <div class="relative max-w-xl mx-auto my-8">
                <input type="search" id="global-search-input" placeholder="Buscar en toda la guía..." class="w-full pl-10 pr-4 py-2 border rounded-full input-custom focus:ring-blue-500 focus:border-blue-500">
                <svg class="w-5 h-5 text-gray-400 absolute top-1/2 left-4 -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
                 <a href="#debut-leucemico" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Debut Leucémico</h3></a>
                <a href="#neutropenia-febril" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Neutropenia Febril</h3></a>
                <a href="#lisis-tumoral" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Síndrome de Lisis Tumoral</h3></a>
                <a href="#anemia" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Anemia</h3></a>
                <a href="#purpura" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Púrpura y PTI</h3></a>
                <a href="#enterocolitis" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Enterocolitis Neutropénica</h3></a>
                 <a href="#hemoderivados" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Hemoderivados</h3></a>
                <a href="#guia-pdf" class="bg-card p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300"><h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400">Guía Completa en PDF</h3></a>
            </div>
        </section>

        <section id="debut-leucemico" class="pt-20 -mt-16">
            <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-blue-500 pb-3 mb-6 flex justify-between items-center">
                    <span>Debut Leucémico</span>
                    <span class="favorite-btn" data-id="debut-leucemico" data-title="Debut Leucémico">★</span>
                </h2>
                <div class="space-y-6">
                    <p>La leucemia es el cáncer más frecuente en la infancia, representando el 30% de las enfermedades malignas en pediatría. El 80% corresponde a Leucemia Linfoblástica Aguda (LLA) y 17% a Leucemia Mieloide Aguda (LMA).</p>
                    <details class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                        <summary class="font-semibold text-lg text-blue-800 dark:text-blue-400">Presentación Clínica y Signos de Alerta</summary>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-bold">Síntomas Clínicos:</h4>
                                <ul class="list-disc list-inside">
                                    <li>Afectación del estado general, síndrome anémico, diátesis hemorrágica, fiebre, dolor óseo, hepatoesplenomegalia, adenopatías.</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold">Laboratorio (Signos de Alerta):</h4>
                                <ul class="list-disc list-inside">
                                    <li>Anemia normocítica, trombocitopenia (&lt;100.000/µl), leucocitosis o leucopenia con blastos en frotis, afectación de ≥2 series, LDH y ácido úrico elevados.</li>
                                </ul>
                            </div>
                        </div>
                    </details>
                </div>
            </div>
        </section>

        <section id="neutropenia-febril" class="pt-20 -mt-16">
            <div class="bg-card p-6 md:p-8 rounded-2xl shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-blue-500 pb-3 mb-6 flex justify-between items-center">
                    <span>Neutropenia Febril (NF)</span>
                    <span class="favorite-btn" data-id="neutropenia-febril" data-title="Neutropenia Febril">★</span>
                </h2>
                <div class="space-y-8">
                    <details class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                        <summary class="font-semibold text-lg text-blue-800 dark:text-blue-400">Herramientas Interactivas de NF</summary>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="calculator-card border-blue-500">
                                <h3 class="font-semibold">Algoritmo de Tratamiento Inicial</h3>
                                <div id="nf-step-1" class="mt-2">
                                    <p class="mb-2">Paso 1: ¿Signos de sepsis/shock?</p>
                                    <div class="flex space-x-4">
                                        <button onclick="handleNfAlgorithm('sepsis_yes')" class="flex-1 bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-600">Sí</button>
                                        <button onclick="handleNfAlgorithm('sepsis_no')" class="flex-1 bg-gray-300 dark:bg-gray-600 py-2 px-4 rounded hover:bg-gray-400">No</button>
                                    </div>
                                </div>
                                <div id="nf-step-2" class="hidden mt-2">
                                    <p class="mb-2">Paso 2: ¿Criterios de Alto Riesgo (NFAR)?</p>
                                    <div class="flex space-x-4">
                                        <button onclick="handleNfAlgorithm('nfar_yes')" class="flex-1 bg-orange-500 text-white font-bold py-2 px-4 rounded hover:bg-orange-600">Sí (NFAR)</button>
                                        <button onclick="handleNfAlgorithm('nfar_no')" class="flex-1 bg-green-500 text-white font-bold py-2 px-4 rounded hover:bg-green-600">No (NFBR)</button>
                                    </div>
                                </div>
                                <div id="nf-result" class="mt-4 p-3 bg-blue-100 dark:bg-blue-900/50 rounded-md text-center hidden"></div>
                                <button id="nf-reset-btn" onclick="resetNfAlgorithm()" class="mt-4 w-full text-sm text-blue-600 hover:underline hidden">Reiniciar</button>
                            </div>
                            <div class="calculator-card border-cyan-500">
                                <h3 class="font-semibold">Manejo Infección de CVC</h3>
                                 <div id="cvc-step-1" class="mt-2">
                                    <p class="mb-2">Paso 1: ¿Infección complicada?</p>
                                    <div class="flex space-x-4">
                                        <button onclick="handleCvcAlgorithm('comp_yes')" class="flex-1 bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-600">Sí</button>
                                        <button onclick="handleCvcAlgorithm('comp_no')" class="flex-1 bg-gray-300 dark:bg-gray-600 py-2 px-4 rounded hover:bg-gray-400">No</button>
                                    </div>
                                </div>
                                <div id="cvc-step-2" class="hidden mt-2">
                                    <p class="mb-2">Paso 2: Microorganismo aislado</p>
                                    <select id="cvc-microorganism" class="w-full p-2 border rounded input-custom">
                                        <option value="s_aureus">S. aureus / Pseudomonas / Candida</option>
                                        <option value="other">Otro microorganismo</option>
                                    </select>
                                    <button onclick="handleCvcAlgorithm('microbe_selected')" class="mt-3 w-full bg-cyan-600 text-white font-bold py-2 px-4 rounded hover:bg-cyan-700">Ver</button>
                                </div>
                                <div id="cvc-result" class="mt-4 p-3 bg-cyan-100 dark:bg-cyan-900/50 rounded-md text-center hidden"></div>
                                <button id="cvc-reset-btn" onclick="resetCvcAlgorithm()" class="mt-4 w-full text-sm text-cyan-600 hover:underline hidden">Reiniciar</button>
                            </div>
                        </div>
                    </details>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-blue-800 dark:text-blue-400">Dosis de Antimicrobianos</h3>
                            <div class="overflow-x-auto max-h-72">
                                <table class="w-full text-left border-collapse" id="drug-table">
                                    <thead class="bg-gray-100 dark:bg-gray-700 sticky top-0"><tr><th class="p-3 border-custom">Antimicrobiano</th><th class="p-3 border-custom">Dosis</th><th class="p-3 border-custom">Intervalo</th></tr></thead>
                                    <tbody class="text-sm">
                                        <tr class="border-b border-custom"><td>Ceftriaxona</td><td>100 mg/kg/día</td><td>24h</td></tr>
                                        <tr class="border-b border-custom"><td>Cefepime</td><td>100 mg/kg/día</td><td>8h</td></tr>
                                        <tr class="border-b border-custom"><td>Piperacilina-Tazobactam</td><td>300 mg/kg/día</td><td>6-8h</td></tr>
                                        <tr class="border-b border-custom"><td>Meropenem</td><td>60 mg/kg/día</td><td>8h</td></tr>
                                        <tr class="border-b border-custom"><td>Vancomicina</td><td>40-60 mg/kg/día</td><td>6h</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                         <div>
                            <h3 class="text-xl font-semibold mb-2 text-blue-800 dark:text-blue-400">Dosis de Antifúngicos</h3>
                            <div class="overflow-x-auto max-h-72">
                                <table class="w-full text-left border-collapse">
                                    <thead class="bg-gray-100 dark:bg-gray-700 sticky top-0"><tr><th class="p-3 border-custom">Antifúngico</th><th class="p-3 border-custom">Dosis</th></tr></thead>
                                    <tbody class="text-sm">
                                        <tr class="border-b border-custom"><td>Anfotericina B Liposomal</td><td>3-5 mg/kg/día</td></tr>
                                        <tr class="border-b border-custom"><td>Voriconazol</td><td>Carga y luego 8-9 mg/kg/dosis</td></tr>
                                        <tr class="border-b border-custom"><td>Caspofungina</td><td>DC: 70mg/m², Manto: 50mg/m²/día</td></tr>
                                        <tr class="border-b border-custom"><td>Fluconazol</td><td>10-12 mg/kg/día</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        </main>

    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-6 py-4 text-center">
            <p>&copy; 2024 Guía de Práctica Clínica Interactiva - Hospital Pediátrico Notti.</p>
            <p class="text-xs text-gray-400 mt-1">Esta herramienta es una ayuda y no reemplaza el juicio clínico profesional.</p>
        </div>
    </footer>

<script>
    // --- SETUP ---
    document.addEventListener('DOMContentLoaded', () => {
        setupMobileMenu();
        setupFavorites();
        setupTabs();
        setupTheme();
        // Delay search setup to ensure content is ready
        setTimeout(setupGlobalSearch, 100);
    });

    // --- THEME ---
    function setupTheme() {
        const themeToggle = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('theme-icon-light');
        const darkIcon = document.getElementById('theme-icon-dark');
        const applyTheme = (theme) => {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                lightIcon.classList.remove('hidden');
                darkIcon.classList.add('hidden');
            }
        };
        const currentTheme = localStorage.getItem('theme') || 'light';
        applyTheme(currentTheme);
        themeToggle.addEventListener('click', () => {
            const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });
    }

    // --- MOBILE MENU & TABS ---
    function setupMobileMenu() {
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
    }
    function setupTabs() {
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                const tab = button.dataset.tab;
                const tabContainer = button.closest('.space-y-8');
                tabContainer.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                tabContainer.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === `tab-content-${tab}`);
                });
            });
        });
    }

    // --- ALGORITHMS ---
    function handleNfAlgorithm(decision) {
        const container = document.getElementById('neutropenia-febril');
        const step1 = container.querySelector('#nf-step-1');
        const step2 = container.querySelector('#nf-step-2');
        const resultDiv = container.querySelector('#nf-result');
        const resetBtn = container.querySelector('#nf-reset-btn');
        let html = '';

        step1.classList.add('hidden');
        if (decision === 'sepsis_yes') {
            html = `<p class="font-bold text-red-700">Tratamiento:</p><p>Carbapenem + Vancomicina.</p>`;
        } else if (decision === 'sepsis_no') {
            step2.classList.remove('hidden'); return;
        } else if (decision === 'nfar_yes') {
            html = `<p class="font-bold text-orange-700">Tratamiento (NFAR):</p><p>Cefepime o Piperacilina/Tazobactam.</p>`;
            step2.classList.add('hidden');
        } else if (decision === 'nfar_no') {
            html = `<p class="font-bold text-green-700">Tratamiento (NFBR):</p><p>Ceftriaxona o Cefotaxima.</p>`;
            step2.classList.add('hidden');
        }
        resultDiv.innerHTML = html;
        resultDiv.classList.remove('hidden');
        resetBtn.classList.remove('hidden');
    }
    function resetNfAlgorithm() {
        const container = document.getElementById('neutropenia-febril');
        container.querySelector('#nf-step-1').classList.remove('hidden');
        container.querySelector('#nf-step-2').classList.add('hidden');
        container.querySelector('#nf-result').classList.add('hidden');
        container.querySelector('#nf-reset-btn').classList.add('hidden');
    }
     function handleCvcAlgorithm(decision) {
        const container = document.getElementById('neutropenia-febril');
        const step1 = container.querySelector('#cvc-step-1');
        const step2 = container.querySelector('#cvc-step-2');
        const resultDiv = container.querySelector('#cvc-result');
        const resetBtn = container.querySelector('#cvc-reset-btn');
        let html = '';

        step1.classList.add('hidden');
        if (decision === 'comp_yes') {
            html = `<p class="font-bold text-red-700">Acción:</p><p>Remover CVC + Terapia Sistémica.</p>`;
        } else if (decision === 'comp_no') {
            step2.classList.remove('hidden'); return;
        } else if (decision === 'microbe_selected') {
            const microbe = container.querySelector('#cvc-microorganism').value;
            if (microbe === 's_aureus') {
                 html = `<p class="font-bold text-red-700">Acción:</p><p>Remover CVC + Terapia Sistémica.</p>`;
            } else {
                html = `<p class="font-bold text-green-700">Acción:</p><p>Terapia de Rescate (Sistémica + Sello).</p>`;
            }
            step2.classList.add('hidden');
        }
        resultDiv.innerHTML = html;
        resultDiv.classList.remove('hidden');
        resetBtn.classList.remove('hidden');
    }
    function resetCvcAlgorithm() {
        const container = document.getElementById('neutropenia-febril');
        container.querySelector('#cvc-step-1').classList.remove('hidden');
        container.querySelector('#cvc-step-2').classList.add('hidden');
        container.querySelector('#cvc-result').classList.add('hidden');
        container.querySelector('#cvc-reset-btn').classList.add('hidden');
    }

    // --- CALCULATORS ---
    const validateWeight = (weight, resultDiv) => {
        if (!weight || weight <= 0) {
            resultDiv.innerHTML = `<p class="text-red-600">Ingrese un peso válido.</p>`;
            resultDiv.classList.remove('hidden');
            return false;
        }
        return true;
    };
    function calculateIgivInfusion() {
        const weight = parseFloat(document.getElementById('igiv-weight').value);
        const resultDiv = document.getElementById('igiv-result');
        if (!validateWeight(weight, resultDiv)) return;
        
        const rates = [0.3, 0.6, 1.2, 2.4, 4.8, 6, 7.2];
        const intervals = [30, 30, 30, 30, 'hasta finalizar', 'hasta finalizar', 'hasta finalizar'];

        let tableHtml = `<h4 class="font-bold mb-2">Plan de Infusión Sugerido (mL/hora)</h4>
                         <div class="overflow-x-auto"><table class="w-full text-sm text-left">
                           <thead class="bg-gray-200 dark:bg-gray-600"><tr>
                             <th class="p-2">Intervalo (min)</th> <th class="p-2">Velocidad (mL/kg/h)</th> <th class="p-2">Velocidad (mL/hora)</th>
                           </tr></thead><tbody>`;

        rates.forEach((rate, i) => {
            const calculatedRate = Math.min(rate * weight, 150).toFixed(1);
            tableHtml += `<tr class="border-b border-custom"><td class="p-2">${intervals[i]}</td><td class="p-2">${rate}</td><td class="p-2 font-bold">${calculatedRate}</td></tr>`;
        });
        
        tableHtml += `</tbody></table></div><p class="text-xs mt-2 italic">Basado en plantilla Garrahan. Monitorear al paciente.</p>`;
        resultDiv.innerHTML = tableHtml;
        resultDiv.classList.remove('hidden');
    }

    // --- FAVORITES & SEARCH ---
    function setupFavorites() {
        const toggleBtn = document.getElementById('favorites-toggle-btn');
        const closeBtn = document.getElementById('close-favorites-btn');
        const panel = document.getElementById('favorites-panel');
        toggleBtn.addEventListener('click', () => panel.classList.remove('translate-x-full'));
        closeBtn.addEventListener('click', () => panel.classList.add('translate-x-full'));
        loadFavorites();
        document.querySelectorAll('.favorite-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite(btn.dataset.id, btn.dataset.title);
                btn.classList.toggle('saved');
            });
        });
    }
    function getFavorites() { return JSON.parse(localStorage.getItem('hemoncoFavoritesV3')) || []; }
    function saveFavorites(favorites) {
        localStorage.setItem('hemoncoFavoritesV3', JSON.stringify(favorites));
        loadFavorites();
    }
    function toggleFavorite(id, title) {
        let favorites = getFavorites();
        const index = favorites.findIndex(fav => fav.id === id);
        if (index > -1) favorites.splice(index, 1);
        else favorites.push({ id, title });
        saveFavorites(favorites);
    }
    function loadFavorites() {
        const favorites = getFavorites();
        const listDiv = document.getElementById('favorites-list');
        const savedIds = favorites.map(f => f.id);
        document.querySelectorAll('.favorite-btn').forEach(btn => btn.classList.toggle('saved', savedIds.includes(btn.dataset.id)));
        if (favorites.length === 0) {
            listDiv.innerHTML = `<p class="text-sm text-gray-500">Guarde secciones con ★ para verlas aquí.</p>`;
            return;
        }
        listDiv.innerHTML = favorites.map(fav => 
            `<a href="#${fav.id}" class="block p-2 bg-gray-100 dark:bg-gray-700 rounded hover:bg-blue-100 dark:hover:bg-blue-900 transition-colors text-sm">${fav.title}</a>`
        ).join('');
        listDiv.querySelectorAll('a').forEach(a => a.addEventListener('click', () => {
            document.getElementById('favorites-panel').classList.add('translate-x-full');
        }));
    }
    
    function setupGlobalSearch() {
        const searchInput = document.getElementById('global-search-input');
        const performSearch = (query) => {
            removeHighlights();
            if (query.length < 3) return;
            const regex = new RegExp(query, 'gi');
            findAndHighlight(document.getElementById('main-content'), regex);
        };
        const findAndHighlight = (node, regex) => {
            if (node.nodeType === 3) {
                if(node.nodeValue.match(regex)){
                    const span = document.createElement('span');
                    span.innerHTML = node.nodeValue.replace(regex, match => `<span class="highlight">${match}</span>`);
                    node.parentNode.replaceChild(span, node);
                }
            } else if (node.nodeType === 1 && node.childNodes && !/script|style|svg/i.test(node.tagName)) {
                node.childNodes.forEach(child => findAndHighlight(child, regex));
            }
        };
        searchInput.addEventListener('input', (e) => performSearch(e.target.value));
    }
    function removeHighlights() {
        document.querySelectorAll('span.highlight').forEach(el => {
            const parent = el.parentNode;
            if(parent) {
                parent.replaceChild(document.createTextNode(el.textContent), el);
                parent.normalize();
            }
        });
    }
</script>


</body>
</html>
